<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–°—Ç–∞–≤–∫–∏ –æ—Ç AI</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: #1c2738;
            color: white; 
            text-align: center;
            padding: 20px;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            min-height: 100vh;
            box-sizing: border-box;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: 350px;
            margin-bottom: 30px;
        }
        h1 {
            font-weight: 500;
            margin: 0;
            font-size: 22px;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ —è–∑—ã–∫–æ–≤ */
        .language-select {
            position: relative;
            cursor: pointer;
            border: 1px solid #313d4f;
            background-color: #1c2738;
            border-radius: 8px;
            min-width: 90px;
        }
        .selected-language {
            display: flex;
            align-items: center;
            padding: 6px 12px;
            gap: 8px;
            font-weight: bold;
        }
        .arrow-down {
            width: 0;
            height: 0;
            border-left: 4px solid transparent;
            border-right: 4px solid transparent;
            border-top: 5px solid white;
            margin-left: auto;
        }
        .language-options {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: #313d4f;
            border-radius: 8px;
            margin-top: 5px;
            overflow: hidden;
            z-index: 10;
        }
        .language-options.show {
            display: block;
        }
        .language-option {
            padding: 10px 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .language-option:hover {
            background-color: #4a586e;
        }
        .flag-icon {
            width: 24px;
            height: 16px;
            border-radius: 3px;
            object-fit: cover;
        }

        .content-area {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
        }
        .button {
            width: 100%;
            max-width: 350px;
            padding: 18px;
            border-radius: 12px;
            font-size: 17px;
            font-weight: bold;
            cursor: pointer;
            border: none;
            box-sizing: border-box;
            transition: background-color 0.2s, margin-bottom 0.2s, margin-top 0.2s; /* –ü–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –¥–ª—è –∫–Ω–æ–ø–æ–∫ */
        }
        .upload-container {
            width: 100%;
            max-width: 350px;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 15px; 
        }
        .upload-hint {
            font-size: 13px;
            color: #8a96a8;
            margin-top: 10px; 
        }
        .primary-button {
            background-color: #00e676;
            color: #1c2738;
            margin-bottom: 15px;
        }
        .primary-button:disabled {
            background-color: #313d4f;
            color: #8a96a8;
            cursor: not-allowed;
            opacity: 0.6;
        }
        .secondary-button {
            background-color: #313d4f;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .secondary-button:disabled {
            background-color: #313d4f;
            color: #8a96a8;
            cursor: not-allowed;
            opacity: 0.6;
        }
        select.button {
            margin-bottom: 15px;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-color: #313d4f;
            color: white;
            padding-left: 20px;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='white'%3e%3cpath d='M8,11L2,5h12L8,11z'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 1em;
        }
        select.button:invalid {
             color: #8a96a8;
        }
        select.button option {
            background: #1c2738;
            color: white;
            font-weight: normal;
        }
        input[type="file"] {
            display: none;
        }
        .uploaded-image-container {
            margin-bottom: 20px;
            max-width: 100%;
            display: flex;
            justify-content: center;
        }
        .uploaded-image {
            max-width: 220px;
            max-height: 220px;
            border-radius: 8px;
            object-fit: contain;
            border: 1px solid #00e676;
        }
        .attempts-text {
            width: 100%;
            max-width: 350px;
            background-color: #2a3649;
            padding: 15px;
            border-radius: 12px;
            box-sizing: border-box;
            margin-top: 0;
            margin-bottom: 20px; /* –û—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É */
        }
        .footer-text {
            font-size: 12px;
            color: #888;
            padding-top: 20px;
        }
        .hidden {
            display: none !important;
        }

        /* --- –°–¢–ò–õ–ò: –≠–ö–†–ê–ù –ó–ê–ì–†–£–ó–ö–ò --- */
        .analysis-container {
            width: 100%;
            max-width: 350px;
            margin-bottom: 15px;
        }
        #analysisStatusText {
            font-size: 14px;
            color: #a0b0c8;
            height: 20px;
        }
        .progress-bar {
            width: 100%;
            background-color: #313d4f;
            border-radius: 8px;
            height: 8px;
            margin-top: 10px;
            overflow: hidden;
        }
        .progress-bar-inner {
            width: 100%;
            height: 100%;
            background-color: #00e676;
            animation: loading-progress 2s linear infinite;
        }
        @keyframes loading-progress {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* --- –°–¢–ò–õ–ò: –†–ï–ó–£–õ–¨–¢–ê–¢–´ --- */
        .results-container {
            width: 100%;
            max-width: 350px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
            margin-bottom: 15px;
        }
        .result-card {
            background-color: #2a3649;
            border-radius: 12px;
            padding: 15px;
            text-align: left;
        }
        .result-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
        }
        .result-card-header > div {
            flex: 1;
        }
        
        .card-title {
            font-size: 12px;
            color: #8a96a8;
            margin-bottom: 5px;
        }
        .confidence-value {
            font-size: 28px;
            font-weight: bold;
            color: #00e676;
        }
        .signal-value {
            font-size: 16px;
            font-weight: bold;
        }
        
        .result-card-header .info-block:first-child {
            border-right: 1px solid #4a586e;
            padding-right: 15px;
        }
        .event-list .event-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }
        .event-list .event-item:last-child {
            margin-bottom: 0;
        }
        .event-name {
            font-size: 14px;
            flex-basis: 50%;
        }
        .event-progress-container {
            flex-basis: 35%;
            background-color: #1c2738;
            height: 8px;
            border-radius: 4px;
        }
        .event-progress-bar {
            height: 100%;
            background-color: #00e676;
            border-radius: 4px;
        }
        .event-percentage {
            font-size: 14px;
            font-weight: bold;
            flex-basis: 10%;
            text-align: right;
        }
        .analytics-title {
            font-size: 12px;
            color: #8a96a8;
            margin-bottom: 8px;
        }
        .analytics-text {
            font-size: 14px;
            line-height: 1.5;
        }
        .analytics-text b {
            color: #00e676;
        }
        
        .custom-alert {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #e53935; /* –ö—Ä–∞—Å–Ω—ã–π —Ü–≤–µ—Ç –¥–ª—è –æ—à–∏–±–∫–∏ */
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            z-index: 1000;
            font-size: 14px;
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            opacity: 1;
            transition: opacity 0.3s ease-out, top 0.3s ease-out;
        }
        .custom-alert.hidden {
            opacity: 0;
            top: 0;
            pointer-events: none;
        }

    </style>
</head>
<body>
    <div class="header">
        <h1>üí° –°—Ç–∞–≤–∫–∏ –æ—Ç AI</h1>
        <div class="language-select">
            <div class="selected-language">
                <img id="selectedLangFlag" class="flag-icon" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 9 6'%3E%3Crect fill='%23fff' width='9' height='3'/%3E%3Crect fill='%23d52b1e' y='3' width='9' height='3'/%3E%3Crect fill='%230039a6' y='2' width='9' height='2'/%3E%3C/svg%3E" alt="Russian Flag">
                <span id="selectedLangText">RU</span>
                <span class="arrow-down"></span>
            </div>
            <div class="language-options">
                <div class="language-option" data-lang="ru">
                    <img class="flag-icon" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 9 6'%3E%3Crect fill='%23fff' width='9' height='3'/%3E%3Crect fill='%23d52b1e' y='3' width='9' height='3'/%3E%3Crect fill='%230039a6' y='2' width='9' height='2'/%3E%3C/svg%3E" alt="Russian Flag">
                    <span>RU</span>
                </div>
                <div class="language-option" data-lang="en">
                    <img class="flag-icon" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 60 30'%3E%3CclipPath id='s'%3E%3Cpath d='M0,0 v30 h60 v-30 z'/%3E%3C/clipPath%3E%3Cpath d='M0,0 v30 h60 v-30 z' fill='%2300247d'/%3E%3Cpath d='M60,0 L0,30 M0,0 L60,30' stroke='%23fff' stroke-width='6' clip-path='url(%23s)'/%3E%3Cpath d='M60,0 L0,30 M0,0 L60,30' stroke='%23cf142b' stroke-width='4' clip-path='url(%23s)'/%3E%3Cpath d='M30,0 v30 M0,15 h60' stroke='%23fff' stroke-width='10'/%3E%3Cpath d='M30,0 v30 M0,15 h60' stroke='%23cf142b' stroke-width='6'/%3E%3C/svg%3E" alt="British Flag">
                    <span>EN</span>
                </div>
            </div>
        </div>
    </div>

    <div class="content-area">
        
        <select id="gameType" class="button">
            <option value="" disabled selected>–¢–∏–ø –∏–≥—Ä—ã</option>
            <option value="football">–§—É—Ç–±–æ–ª</option>
            <option value="basketball">–ë–∞—Å–∫–µ—Ç–±–æ–ª</option>
            <option value="tennis">–¢–µ–Ω–Ω–∏—Å</option>
            <option value="hockey">–•–æ–∫–∫–µ–π</option>
            <option value="volleyball">–í–æ–ª–µ–π–±–æ–ª</option>
            <option value="boxing">–ë–æ–∫—Å</option>
            <option value="mma">MMA</option>
            <option value="ufc">UFC</option>
            <option value="table-tennis">–ù–∞—Å—Ç–æ–ª—å–Ω—ã–π —Ç–µ–Ω–Ω–∏—Å</option>
            <option value="baseball">–ë–µ–π—Å–±–æ–ª</option>
            <option value="handball">–ì–∞–Ω–¥–±–æ–ª</option>
            <option value="rugby">–†–µ–≥–±–∏</option>
            <option value="cricket">–ö—Ä–∏–∫–µ—Ç</option>
            <option value="dota2">Dota 2</option>
            <option value="cs2">CS2</option>
        </select>

        <div id="resultsContainer" class="results-container hidden">
            <!-- –°—é–¥–∞ –±—É–¥—É—Ç –≤—Å—Ç–∞–≤–ª—è—Ç—å—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–∑ JS -->
        </div>

        <div id="imagePreview" class="uploaded-image-container hidden">
            <img class="uploaded-image" src="" alt="–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è">
        </div>
        
        <div id="uploadContainer" class="upload-container">
            <label for="imageUpload" id="uploadLabel" class="button secondary-button">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path></svg>
                –ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è
            </label>
            <p class="upload-hint">–ò–ª–∏ –ø—Ä–æ—Å—Ç–æ –≤—Å—Ç–∞–≤—å—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç (Ctrl + V)</p>
        </div>
        <input type="file" id="imageUpload" accept="image/*">
        
        <button id="analyzeButton" class="button primary-button" disabled>üîç –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞–≤–∫—É</button>
        
        <div id="analysisContainer" class="analysis-container hidden">
            <p id="analysisStatusText">–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º...</p>
            <div class="progress-bar">
                <div class="progress-bar-inner"></div>
            </div>
        </div>
        
        <button id="tryAgainButton" class="button secondary-button hidden" style="margin-bottom: 15px;">üîÑ –í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</button>
        
        <p id="attemptsText" class="attempts-text">–û—Å—Ç–∞–ª–æ—Å—å –ø–æ–ø—ã—Ç–æ–∫ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è: 10 –∏–∑ 10</p>
    </div>

    <p class="footer-text">–°–æ–∑–¥–∞–Ω–æ –Ω–µ–π—Ä–æ—Å–µ—Ç—å—é BetGPT - ¬© 2025</p>

    <div id="customAlert" class="custom-alert hidden"></div>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        
        // --- –ò–ó–ú–ï–ù–ï–ù–ò–ï: –í–ê–® API-–ö–õ–Æ–ß –û–¢ GEMINI ---
        const GEMINI_API_KEY = "AIzaSyDo1fbHqoRxLqVxJkoRel58iG_bOvWLqnU"; // <-- –°—é–¥–∞ –≤—Å—Ç–∞–≤–ª–µ–Ω –≤–∞—à –∫–ª—é—á

        // --- –í–∞—à —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–æ–º–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –∫ –∫–∞–∂–¥–æ–º—É –∑–∞–ø—Ä–æ—Å—É AI ---
        const MY_CUSTOM_PROMPT = "–ê–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å—Ç–∞–≤–∫–∏ —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –∫–∞–ø–ø–µ—Ä–∞. –ë—É–¥—å –∫—Ä–∞—Ç–æ–∫, –Ω–æ —É–±–µ–¥–∏—Ç–µ–ª–µ–Ω."; 

        let currentLang = 'ru';
        let attemptsLeft = 10;
        let totalAttempts = 10;
        let isAnalyzing = false; 

        const translations = {
            'ru': {
                'title': 'üí° –°—Ç–∞–≤–∫–∏ –æ—Ç AI',
                'gameType': '–¢–∏–ø –∏–≥—Ä—ã',
                'uploadLabel': '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path></svg> –ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è',
                'uploadHint': '–ò–ª–∏ –ø—Ä–æ—Å—Ç–æ –≤—Å—Ç–∞–≤—å—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç (Ctrl + V)',
                'analyzeButton': 'üîç –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞–≤–∫—É',
                'analyzeButtonLoading': '‚è≥ –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º...',
                'tryAgainButton': 'üîÑ –í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ',
                'attemptsText': '–û—Å—Ç–∞–ª–æ—Å—å –ø–æ–ø—ã—Ç–æ–∫ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è: {left} –∏–∑ {total}',
                'footerText': '–°–æ–∑–¥–∞–Ω–æ –Ω–µ–π—Ä–æ—Å–µ—Ç—å—é BetGPT - ¬© 2025',
                'alert_select_image': '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è.',
                'alert_select_game_type': '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∏–≥—Ä—ã.',
                'alert_no_attempts': '–£ –≤–∞—Å –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å –ø–æ–ø—ã—Ç–∫–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è.',
                'alert_api_key_missing': 'API –∫–ª—é—á –¥–ª—è Gemini –Ω–µ —É–∫–∞–∑–∞–Ω. –ê–Ω–∞–ª–∏–∑ –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω.',
                'alert_api_error': '–û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –∏–ª–∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.',
                // –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ô: –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–ª—é—á–∏ –¥–ª—è —è–∑—ã–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∏ —Å–∏—Å—Ç–µ–º–Ω–æ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
                'analyze_prompt': '–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —ç—Ç—É —Å—Ç–∞–≤–∫—É –Ω–∞ {gameType}.',
                'system_prompt': `–¢—ã ‚Äî –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π AI-–∞–Ω–∞–ª–∏—Ç–∏–∫ —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π BetGPT. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –∏–∑—É—á–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã, –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –∏ –¥—Ä—É–≥—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –Ω–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–µ, —á—Ç–æ–±—ã –¥–∞—Ç—å –ø—Ä–æ–≥–Ω–æ–∑. ${MY_CUSTOM_PROMPT ? `–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —É—á—Ç–∏ —Å–ª–µ–¥—É—é—â—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é: "${MY_CUSTOM_PROMPT}".` : ''} –í—Å–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –ø–æ–ª—è –≤ —Ç–≤–æ–µ–º JSON-–æ—Ç–≤–µ—Ç–µ (—Ç–∞–∫–∏–µ –∫–∞–∫ 'signal' –∏ 'analytics') –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ. –í–µ—Ä–Ω–∏ –æ—Ç–≤–µ—Ç –°–¢–†–û–ì–û –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–π —Å—Ö–µ–º–µ.`,
                'analysis_steps': [
                    '–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ...',
                    '–°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ –∫–æ–º–∞–Ω–¥–∞—Ö...',
                    '–ü—Ä–æ–≤–æ–¥–∏–º –ò–ò –∞–Ω–∞–ª–∏–∑...',
                    '–í—ã—Å—á–∏—Ç—ã–≤–∞–µ–º –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏...'
                ],
                'results_confidence': '–£–í–ï–†–ï–ù–ù–û–°–¢–¨ AI',
                'results_signal': '–ù–ê–î–Å–ñ–ù–´–ô –°–ò–ì–ù–ê–õ',
                'results_events': '% –°–û–ë–´–¢–ò–ô',
                'results_analytics': '–ê–ò –ê–ù–ê–õ–ò–¢–ò–ö–ê',
                'gameTypes': {
                    'football': '–§—É—Ç–±–æ–ª', 'basketball': '–ë–∞—Å–∫–µ—Ç–±–æ–ª', 'tennis': '–¢–µ–Ω–Ω–∏—Å',
                    'hockey': '–•–æ–∫–∫–µ–π', 'volleyball': '–í–æ–ª–µ–π–±–æ–ª', 'boxing': '–ë–æ–∫—Å',
                    'mma': 'MMA', 'ufc': 'UFC', 'table-tennis': '–ù–∞—Å—Ç–æ–ª—å–Ω—ã–π —Ç–µ–Ω–Ω–∏—Å',
                    'baseball': '–ë–µ–π—Å–±–æ–ª', 'handball': '–ì–∞–Ω–¥–±–æ–ª', 'rugby': '–†–µ–≥–±–∏',
                    'cricket': '–ö—Ä–∏–∫–µ—Ç', 'dota2': 'Dota 2', 'cs2': 'CS2'
                }
            },
            'en': {
                'title': 'üí° AI Bets',
                'gameType': 'Game Type',
                'uploadLabel': '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path></svg> Upload event image',
                'uploadHint': 'Or just paste a screenshot (Ctrl + V)',
                'analyzeButton': 'üîç Analyze bet',
                'analyzeButtonLoading': '‚è≥ Analyzing...',
                'tryAgainButton': 'üîÑ Choose another image',
                'attemptsText': 'Attempts left today: {left} of {total}',
                'footerText': 'Created by BetGPT neural network - ¬© 2025',
                'alert_select_image': 'Please upload an event image first.',
                'alert_select_game_type': 'Please select a game type first.',
                'alert_no_attempts': 'You have no attempts left for today.',
                'alert_api_key_missing': 'Gemini API key is not provided. Analysis is not possible.',
                'alert_api_error': 'Error during analysis. Please check the console or try again later.',
                 // –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ô: –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–ª—é—á–∏ –¥–ª—è —è–∑—ã–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∏ —Å–∏—Å—Ç–µ–º–Ω–æ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
                'analyze_prompt': 'Analyze this bet on {gameType}.',
                'system_prompt': `You are a professional AI sports analyst BetGPT. Your task is to study the teams, odds, and other information on the screenshot to provide a forecast. ${MY_CUSTOM_PROMPT ? `Additionally, consider this instruction: "${MY_CUSTOM_PROMPT}".` : ''} All text fields in your JSON response (such as 'signal' and 'analytics') must be in English. Respond STRICTLY in the JSON format that matches the provided schema.`,
                 'analysis_steps': [
                    'Analyzing image...',
                    'Gathering team data...',
                    'Performing AI analysis...',
                    'Calculating probabilities...'
                ],
                'results_confidence': 'AI CONFIDENCE',
                'results_signal': 'RELIABLE SIGNAL',
                'results_events': '% OF EVENTS',
                'results_analytics': 'AI ANALYTICS',
                'gameTypes': {
                    'football': 'Football', 'basketball': 'Basketball', 'tennis': 'Tennis',
                    'hockey': 'Hockey', 'volleyball': 'Volleyball', 'boxing': 'Boxing',
                    'mma': 'MMA', 'ufc': 'UFC', 'table-tennis': 'Table Tennis',
                    'baseball': 'Baseball', 'handball': 'Handball', 'rugby': 'Rugby',
                    'cricket': 'Cricket', 'dota2': 'Dota 2', 'cs2': 'CS2'
                }
            }
        };

        // --- –≠–ª–µ–º–µ–Ω—Ç—ã DOM ---
        const imageUpload = document.getElementById('imageUpload');
        const uploadContainer = document.getElementById('uploadContainer');
        const imagePreviewContainer = document.getElementById('imagePreview');
        const imagePreview = document.querySelector('#imagePreview img');
        const analyzeButton = document.getElementById('analyzeButton');
        const tryAgainButton = document.getElementById('tryAgainButton');
        const attemptsTextElement = document.getElementById('attemptsText');
        const gameTypeSelect = document.getElementById('gameType');
        
        const selectedLanguage = document.querySelector('.selected-language');
        const languageOptionsContainer = document.querySelector('.language-options');
        const languageOptions = document.querySelectorAll('.language-option');
        const selectedLangFlag = document.getElementById('selectedLangFlag');
        const selectedLangText = document.getElementById('selectedLangText');

        const analysisContainer = document.getElementById('analysisContainer');
        const analysisStatusText = document.getElementById('analysisStatusText');
        const resultsContainer = document.getElementById('resultsContainer');
        let analysisInterval;
        
        function showCustomAlert(message) {
            const customAlert = document.getElementById('customAlert');
            customAlert.textContent = message;
            customAlert.classList.remove('hidden');

            setTimeout(() => {
                customAlert.classList.add('hidden');
            }, 3000);
        }

        function updateAnalyzeButtonState() {
            const imageLoaded = !imagePreviewContainer.classList.contains('hidden');
            analyzeButton.disabled = !imageLoaded;
        }

        function updateAttemptsText() {
            const t = translations[currentLang];
            attemptsTextElement.textContent = t.attemptsText
                .replace('{left}', attemptsLeft)
                .replace('{total}', totalAttempts);
        }

        function setLanguage(lang) {
            const t = translations[lang];
            document.querySelector('h1').innerHTML = t.title;
            document.querySelector('#gameType option[disabled]').textContent = t.gameType;
            document.getElementById('uploadLabel').innerHTML = t.uploadLabel;
            document.querySelector('.upload-hint').innerHTML = t.uploadHint;
            
            analyzeButton.innerHTML = isAnalyzing ? t.analyzeButtonLoading : t.analyzeButton;
            tryAgainButton.innerHTML = t.tryAgainButton;
            updateAttemptsText();
            document.querySelector('.footer-text').textContent = t.footerText;

            const gameOptions = gameTypeSelect.querySelectorAll('option:not([disabled])');
            gameOptions.forEach(option => {
                const gameKey = option.value;
                if (t.gameTypes[gameKey]) {
                    option.textContent = t.gameTypes[gameKey];
                }
            });
        }

        selectedLanguage.addEventListener('click', () => {
            languageOptionsContainer.classList.toggle('show');
        });

        languageOptions.forEach(option => {
            option.addEventListener('click', () => {
                currentLang = option.dataset.lang;
                selectedLangFlag.src = option.querySelector('.flag-icon').src;
                selectedLangText.textContent = option.querySelector('span').textContent;
                setLanguage(currentLang);
                languageOptionsContainer.classList.remove('show');
            });
        });
        
        window.addEventListener('click', (e) => {
            if (!document.querySelector('.language-select').contains(e.target)) {
                languageOptionsContainer.classList.remove('show');
            }
        });

        function showImage(file) {
            resultsContainer.classList.add('hidden');

            const reader = new FileReader();
            reader.onload = function(e) {
                imagePreview.src = e.target.result;
                imagePreviewContainer.classList.remove('hidden');
                uploadContainer.classList.add('hidden');
                
                analyzeButton.classList.remove('hidden'); // –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ô: –≠—Ç–∞ —Å—Ç—Ä–æ–∫–∞ –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç –æ—à–∏–±–∫—É, –ø–æ–∫–∞–∑—ã–≤–∞—è –∫–Ω–æ–ø–∫—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –Ω–æ–≤–æ–≥–æ —Ñ–æ—Ç–æ
                // –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ô: –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–ª—è —Å–±—Ä–æ—Å–∞ —Ç–µ–∫—Å—Ç–∞ –∫–Ω–æ–ø–∫–∏ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è
                analyzeButton.innerHTML = translations[currentLang].analyzeButton; 
                isAnalyzing = false;
                
                updateAnalyzeButtonState();
                tryAgainButton.classList.remove('hidden');
            };
            reader.readAsDataURL(file);
        }

        imageUpload.addEventListener('change', (event) => {
            if (event.target.files[0]) showImage(event.target.files[0]);
        });
        
        document.addEventListener('paste', (event) => {
            const items = (event.clipboardData || event.originalEvent.clipboardData).items;
            for (let index in items) {
                const item = items[index];
                if (item.kind === 'file' && item.type.startsWith('image/')) {
                    showImage(item.getAsFile());
                }
            }
        });
        
        function resetToInitialState() {
            imageUpload.value = '';
            isAnalyzing = false;
            
            imagePreviewContainer.classList.add('hidden');
            resultsContainer.classList.add('hidden');
            analysisContainer.classList.add('hidden');
            uploadContainer.classList.remove('hidden');
            
            analyzeButton.disabled = true;
            analyzeButton.innerHTML = translations[currentLang].analyzeButton;
            analyzeButton.classList.remove('hidden');
            analyzeButton.style.marginBottom = '';

            tryAgainButton.classList.add('hidden');
            tryAgainButton.disabled = false;
            gameTypeSelect.disabled = false;
            gameTypeSelect.classList.remove('hidden');
        }

        tryAgainButton.addEventListener('click', resetToInitialState);

        function displayResults(data) {
            const t = translations[currentLang];
            
            resultsContainer.innerHTML = `
                <div class="result-card">
                    <div class="result-card-header">
                        <div class="info-block">
                            <div class="card-title">${t.results_confidence}</div>
                            <div class="confidence-value">${data.confidence || 'N/A'}%</div>
                        </div>
                        <div class="info-block">
                            <div class="card-title">${t.results_signal}</div>
                            <div class="signal-value">${data.signal || 'N/A'}</div>
                        </div>
                    </div>
                </div>
                <div class="result-card event-list">
                    <div class="card-title">${t.results_events}</div>
                    ${(data.events || []).map(event => `
                        <div class="event-item">
                            <span class="event-name">${event.name}</span>
                            <div class="event-progress-container">
                                <div class="event-progress-bar" style="width: ${event.probability}%;"></div>
                            </div>
                            <span class="event-percentage">${event.probability}%</span>
                        </div>
                    `).join('')}
                </div>
                <div class="result-card">
                    <div class="analytics-title">${t.results_analytics}</div>
                    <p class="analytics-text">${data.analytics || '–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞.'}</p>
                </div>
            `;
            resultsContainer.classList.remove('hidden');
        }

        // --- –ò–ó–ú–ï–ù–ï–ù–ò–ï: –í–°–Ø –§–£–ù–ö–¶–ò–Ø 'analyzeBet' –ó–ê–ú–ï–ù–ï–ù–ê –ù–ê –õ–û–ì–ò–ö–£ GEMINI ---
        async function analyzeBet() {
            const t = translations[currentLang];
            console.log("--- Starting Bet Analysis with Gemini 2.5 Flash ---"); 

            if (gameTypeSelect.value === '') {
                console.warn("Validation failed: Game type not selected.");
                showCustomAlert(t.alert_select_game_type);
                return;
            }
            
            if (!GEMINI_API_KEY) {
                console.error("Initialization failed: Gemini API key is missing.");
                showCustomAlert(t.alert_api_key_missing);
                return;
            }
            if (attemptsLeft <= 0) {
                 console.warn("Validation failed: No attempts left.");
                 showCustomAlert(t.alert_no_attempts);
                 return;
            }
            
            attemptsLeft--;
            updateAttemptsText();
            isAnalyzing = true;
            
            console.log("UI state updated for analysis.");
            analyzeButton.innerHTML = t.analyzeButtonLoading;
            analyzeButton.disabled = true; 
            analyzeButton.style.marginBottom = '5px';
            analysisContainer.classList.remove('hidden');
            tryAgainButton.classList.remove('hidden');
            tryAgainButton.disabled = true;
            imagePreviewContainer.classList.add('hidden');

            // –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ô: –ë–ª–æ–∫–∏—Ä—É–µ–º –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ –Ω–∞ –≤—Ä–µ–º—è –∞–Ω–∞–ª–∏–∑–∞
            gameTypeSelect.disabled = true;

            let step = 0;
            const steps = t.analysis_steps;
            analysisStatusText.textContent = steps[step];
            analysisInterval = setInterval(() => {
                step = (step + 1) % steps.length;
                analysisStatusText.textContent = steps[step];
            }, 2000);
            
            try {
                const imageBase64_full = imagePreview.src;
                const gameTypeValue = gameTypeSelect.options[gameTypeSelect.selectedIndex].text;

                // –ò–ó–ú–ï–ù–ï–ù–ò–ï: –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç –ø—Ä–æ–º–ø—Ç–∞ –∏ —Å–∏—Å—Ç–µ–º–Ω–æ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∏–∑ –æ–±—ä–µ–∫—Ç–∞ translations
                // –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —è–∑—ã–∫–∞ (currentLang)
                const userPromptText = t.analyze_prompt.replace('{gameType}', gameTypeValue);
                const systemPromptText = t.system_prompt;

                const mimeType = imageBase64_full.split(',')[0].split(':')[1].split(';')[0];
                const base64Data = imageBase64_full.split(',')[1];
                
                // –ò–ó–ú–ï–ù–ï–ù–û: –°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è Gemini
                const systemInstruction = {
                  parts: [{
                    text: systemPromptText // –ò–ó–ú–ï–ù–ï–ù–ò–ï: –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—Å—Ç –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —è–∑—ã–∫–µ
                  }]
                };

                // –ò–ó–ú–ï–ù–ï–ù–û: JSON-—Å—Ö–µ–º–∞ –¥–ª—è Gemini. 
                const responseSchema = {
                  type: "OBJECT",
                  properties: {
                    "confidence": { type: "NUMBER" },
                    "signal": { type: "STRING" },
                    "events": {
                      type: "ARRAY",
                      items: {
                        type: "OBJECT",
                        properties: {
                          "name": { type: "STRING" },
                          "probability": { type: "NUMBER" }
                        },
                        required: ["name", "probability"]
                      }
                    },
                    "analytics": { type: "STRING" }
                  },
                  required: ["confidence", "signal", "events", "analytics"]
                };

                // –ò–ó–ú–ï–ù–ï–ù–û: –¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è Gemini
                const requestBody = {
                  contents: [
                    {
                      parts: [
                        { text: userPromptText }, // –ò–ó–ú–ï–ù–ï–ù–ò–ï: –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—Å—Ç –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —è–∑—ã–∫–µ
                        {
                          inlineData: {
                            mimeType: mimeType,
                            data: base64Data
                          }
                        }
                      ]
                    }
                  ],
                  systemInstruction: systemInstruction,
                  generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: responseSchema
                  }
                };
                
                console.log("Sending request to Gemini API."); 

				// –ò–ó–ú–ï–ù–ï–ù–û: URL –∏ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è Gemini
				const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${GEMINI_API_KEY}`;
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestBody)
                });
                
                console.log("Received response object from API:", response);
                const responseText = await response.text();
                console.log("Raw response text from API:", responseText);

                if (!response.ok) {
                    let errorData;
                    try {
                        errorData = JSON.parse(responseText);
                    } catch (e) {
                        errorData = { error: { message: "Failed to parse error response from API." } };
                    }
                    console.error('Gemini API Error Response:', errorData); 
                    throw new Error(errorData.error ? errorData.error.message : 'Network response was not ok');
                }

                const data = JSON.parse(responseText);
                console.log("Parsed API response JSON:", data);
                
                // –ò–ó–ú–ï–ù–ï–ù–û: –ü–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞ –æ—Ç Gemini
                if (!data.candidates || !data.candidates[0] || !data.candidates[0].content || !data.candidates[0].content.parts || !data.candidates[0].content.parts[0].text) {
                    console.error("Invalid response structure from Gemini API:", data);
                    throw new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å –∫–æ–Ω—Ç–µ–Ω—Ç –∏–∑ –æ—Ç–≤–µ—Ç–∞ API.");
                }
                
                const messageContent = data.candidates[0].content.parts[0].text; 
                console.log("Attempting to parse message content:", messageContent);
                const results = JSON.parse(messageContent);
                console.log("Successfully parsed analysis results:", results);
                
                displayResults(results);

            } catch (error) {
                console.error('--- ERROR during API call or processing ---');
                console.error('Full error object:', error);
                showCustomAlert(t.alert_api_error);
                attemptsLeft++;
                updateAttemptsText();
                resetToInitialState();
            } finally {
                console.log("--- Analysis process finished ---");
                clearInterval(analysisInterval);
                isAnalyzing = false;
                analysisContainer.classList.add('hidden');
                analyzeButton.classList.add('hidden');
                
                // –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ô: –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —Å—Ç–∏–ª—å –æ—Ç—Å—Ç—É–ø–∞, —á—Ç–æ–±—ã –æ–Ω –≤–µ—Ä–Ω—É–ª—Å—è –∫ 15px –∏–∑ CSS
                analyzeButton.style.marginBottom = ''; 
                
                tryAgainButton.disabled = false;
                
                // –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ô: –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ –ø–æ—Å–ª–µ –∞–Ω–∞–ª–∏–∑–∞
                gameTypeSelect.disabled = false;
            }
        }
        
        analyzeButton.onclick = analyzeBet; 

        document.addEventListener('DOMContentLoaded', () => {
            tg.ready();
            const urlParams = new URLSearchParams(window.location.search);
            const userId = urlParams.get('user_id');
            
            updateAttemptsText();
            setLanguage(currentLang);
        });

    </script>
</body>
</html>